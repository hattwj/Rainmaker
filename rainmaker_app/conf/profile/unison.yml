output_dict:
    type: regex_dict
    desc: Patterns for Unison stdout and stderr
    default:
        archives_locked: 'Fatal error: Warning: the archives are locked.'
        first_run: 'Warning: No archive files were found for these roots, whose canonical names are:'
        normal: 'Nothing to do'
        delete: 'Deleting'
        fatal_error: 'Fatal error'
        warning: 'Warning:'
        update: 'Updating file'
        syntax: 'too many roots'
        copy: 'Copying'
ignore_patterns:
    type: array_fnmatch
    default:
        - '*unison.tmp' 
    desc: 'patterns for fs monitor to ignore'
guid: 
    type: str
    default: '${rand:10}' 
    desc: 'profile global id'
fsmon_log: 
    type: str
    default: '${guid}.log' 
    desc: 'file for sending fs events'
type: {val: unison,default: unison, desc: profile type, type: str}
auto:
    default: True 
    type: bool
    desc: automatically start syncing 
title:
    default: unison
    type: str
    desc: 'profile name'
user:
    default: '${current_user}'
    type: str
    desc: 'server user name'
port:
    default: 22
    type: int
    desc: 'server ssh port'
address:
    default: localhost 
    type: str
    desc: 'server address'
ssh_key_path:
    default: /home/${user}/.ssh/rain
    type: localpath
    desc: 'ssh private key {full -path}'
local_root:
    default: /home/${user}/sync
    type: localpath
    desc: 'local root'
local_tmp_dir: {default: '${user_dir}/tmp', type: path, desc: path for importing server events}
local_events_dir: {default: '${user_dir}/events', type: path, desc: path for local fs events}
remote_events_dir: {default: '${abs_path:${remote_root}/../events}', type: path, desc: path to retrieve fs events from server}
backupdir: {default: '${abs_path:${remote_root}/../backups}', type: path, desc: path to store file versions}
remote_uri:
    default: 'ssh://${user}@${address}:${port}/'
    type: str
    desc: null
remote_root:
    default: '/home/${user}/sync'
    type: str
    desc: null
recursive: {default: True, desc: recursive sync, type: bool}
max_threads: {default: 5, desc: max threads, type: int}
max_backups:
    default: 10
    type: int
    desc: 'max backups'
cmd_for_deleted_group:
    type: str
    desc: execute a single command after several events occurred
    default: '${unison_base} ${for_each:[events," -path ${quote:${event_src_path_rel}}"]}'
cmd_for_modified_group:
    type: str
    desc: execute a single command after several events occurred
    default: '${unison_base} ${for_each:[events," -path ${quote:${event_src_path_rel}}"]}'
cmd_for_moved_group:
    type: str
    desc: execute a single command after several events occurred
    default: '${unison_base} ${for_each:[events," -path ${quote:${event_src_path_rel}} -path ${quote:${event_src_path_rel}}"]}'
cmd_for_created_group:
    type: str
    desc: execute a single command after several events occurred
    default: '${unison_base} ${for_each:[events," -path ${quote:${event_src_path_rel}}"]}'
cmd_sync_send: 
    type: str
    default: "${which:unison} ${local_events_dir} ${remote_uri}${remote_events_dir} ${unison_options} -force ${local_events_dir} -path ${fsmon_log}"
    desc: 'server side event sync command - send events'
cmd_sync_recieve: 
    type: str
    default: "${which:unison} ${local_tmp_dir} ${remote_uri}${remote_events_dir} -force ${remote_uri}${remote_events_dir} ${unison_options} -ignore 'Name ${fsmon_log}'"
    desc: 'server side event sync command - recieve events'
startup: 
    type: str
    default: '${unison_base}'
    desc: 'startup command'
shutdown:
    type: str
    default: null
    desc: 'shutdown commands'
do_ignores: 
    desc: Add ignore paths
    type: str
    default: "${for_each:[ignore_patterns,' -ignore=\"Name ${pattern}\"',pattern]}"
unison_sync:
    type: str
    desc: base cmd for server sync
    default: "${which:unison} ${local_events_dir} ${remote_uri}/${remote_events_dir} ${unison_options}"
unison_base:
    type: str
    desc: base unison cmd
    default: "${which:unison} ${local_root} ${remote_uri}${remote_root} ${unison_options}"
unison_options:
    type: str
    desc: standard flags used for all unison sync commands
    default: "-ui text -auto -batch -sshargs '-i ${ssh_key_path}' -backuplocation 'central' -backup 'Name *' -backupprefix '$VERSION.' -backupdir='${backupdir}' -maxbackups=${max_backups} -confirmbigdel=false ${do_ignores}"
