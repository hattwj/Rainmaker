
setup:
    sync_path:
        - {root: '/sync1'}
        - {root: '/sync2'}
        - {root: '/sync3'}

# test ability to find differences between sync paths
test_resolve_syncs:
    #expected related file ids and state
    expected:
        - [ [1,2], [2],  4]
        - [ [4,5], [5],  4]
        - [ [8,9], [8],  2]
        - [ [11,12],[11], 2]
        - [ [13,14],[14], 3]
        - [ [16],[16], 0]
        - [ [17],[17], 0]
        - [ [18],[18], 0]
        - [ [19],[19], 0]

    sync_comparison:
        - { my_file_id: 1, sync_path_id: 2}
        - { my_file_id: 3, sync_path_id: 1}

    my_file:
        # deleted dir  1,2 - 4
        - {fhash: 0, state: 1, path: a_deleted_dir, is_dir: True, sync_path_id: 1 } 
        - {fhash: 0, state: 4, path: a_deleted_dir, is_dir: True, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: a_deleted_dir, is_dir: True, sync_path_id: 2, next_id: 2 }
        # deleted file 4,5 - 4
        - {fhash: 0, state: 1, path: a_deleted_file, is_dir: False, sync_path_id: 1 } 
        - {fhash: 0, state: 4, path: a_deleted_file, is_dir: False, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: a_deleted_file, is_dir: False, sync_path_id: 2, next_id: 5 }
        # moved dirs  8,9 - 2
        - {fhash: 0, state: 1, path: moved_dir_old, is_dir: True, sync_path_id: 1, next_id: 8 } 
        - {fhash: 0, state: 1, path: moved_dir_new, is_dir: True, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: moved_dir_old, is_dir: True, sync_path_id: 2 }        
        # moved files 11,12 - 2
        - {fhash: 0, state: 1, path: moved_file_old, is_dir: False, sync_path_id: 1, next_id: 11 } 
        - {fhash: 0, state: 1, path: moved_file_new, is_dir: False, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: moved_file_old, is_dir: False, sync_path_id: 2 }
        # modified files 13,14 - 3
        - {fhash: 8, state: 1, path: modified_file, is_dir: False, sync_path_id: 1 } 
        - {fhash: 9, state: 1, path: modified_file, is_dir: False, sync_path_id: 2 }
        - {fhash: 8, state: 1, path: modified_file, is_dir: False, sync_path_id: 2, next_id: 14 }
        # new dirs - 16,17 - 0
        - {fhash: 0, state: 1, path: b_new_dir, is_dir: True, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: c_new_dir, is_dir: True, sync_path_id: 2 } 
        # new files - 18,19 - 0
        - {fhash: 0, state: 1, path: b_new_file, is_dir: False, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: c_new_file, is_dir: False, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: c_new_file, is_dir: False, sync_path_id: 3 }

# no conflict, but one side has deleted an empty dir
test_deleted_no_conflict:
    my_file:
        - {fhash: 0, state: 1, path: a, is_dir: True, sync_path_id: 1 } 
        - {fhash: 0, state: 4, path: a, is_dir: True, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: a, is_dir: True, sync_path_id: 2, next_id: 2 }
        - {fhash: 0, state: 1, path: b, is_dir: True, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: b, is_dir: True, sync_path_id: 2 } 
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 1 } 
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 2, next_id: 9 } 
        - {fhash: 8, state: 1, path: c1, is_dir: False, sync_path_id: 2, next_id: 9 } 
        - {fhash: 8, state: 4, path: c1, is_dir: False, sync_path_id: 2 } 
    sync_comparison:
        - { my_file_id: 1, sync_path_id: 2}
        - { my_file_id: 3, sync_path_id: 1}
        - { my_file_id: 4, sync_path_id: 1}
        - { my_file_id: 7, sync_path_id: 1}
        - { my_file_id: 6, sync_path_id: 2}

# no conflict, but updates on both sides
test_modified_no_conflict:
    my_file:
        - {fhash: 0, state: 1, path: a, is_dir: False, sync_path_id: 1 } 
        - {fhash: 8, state: 1, path: a, is_dir: False, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: a, is_dir: False, sync_path_id: 2, next_id: 2 }
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 1 } 
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 2, next_id: 7 } 
        - {fhash: 8, state: 1, path: c1, is_dir: False, sync_path_id: 2, next_id: 7 } 
        - {fhash: 9, state: 1, path: c1, is_dir: False, sync_path_id: 2 } 
    sync_comparison:
        - { my_file_id: 1, sync_path_id: 2}
        - { my_file_id: 3, sync_path_id: 1}
        - { my_file_id: 4, sync_path_id: 2}
        - { my_file_id: 5, sync_path_id: 1}
        - { my_file_id: 6, sync_path_id: 1}
# no conflict, but moves on both sides
test_moved_no_conflict:
    my_file:
        - {fhash: 0, state: 1, path: a, is_dir: False, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: b, is_dir: False, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: a, is_dir: False, sync_path_id: 2, next_id: 2 }
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 1 } 
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 2, next_id: 7 } 
        - {fhash: 7, state: 1, path: c1, is_dir: False, sync_path_id: 2, next_id: 7 } 
        - {fhash: 7, state: 1, path: c2, is_dir: False, sync_path_id: 2 } 
    sync_comparison:
        - { my_file_id: 1, sync_path_id: 2}
        - { my_file_id: 3, sync_path_id: 1}
        - { my_file_id: 4, sync_path_id: 2}
        - { my_file_id: 5, sync_path_id: 1}
        - { my_file_id: 6, sync_path_id: 1}
# no conflict, but new_files on both sides
test_new_no_conflict:
    my_file:
        - {fhash: 0, state: 1, path: a1, is_dir: False, sync_path_id: 1 } 
        - {fhash: 1, state: 1, path: b1, is_dir: False, sync_path_id: 1 }
        - {fhash: 2, state: 1, path: c1, is_dir: False, sync_path_id: 1 }
        - {fhash: 3, state: 1, path: a2, is_dir: False, sync_path_id: 2 } 
        - {fhash: 4, state: 1, path: b2, is_dir: False, sync_path_id: 2 } 
        - {fhash: 5, state: 1, path: c2, is_dir: False, sync_path_id: 2 } 
# conflict, but simple
test_simple_conflict:
    my_file:
        - {fhash: 0, state: 1, path: a, is_dir: False, sync_path_id: 1 } 
        - {fhash: 1, state: 1, path: a, is_dir: False, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: b, is_dir: False, sync_path_id: 1 } 
        - {fhash: 1, state: 1, path: b, is_dir: False, sync_path_id: 2 }
# conflict renamed
test_renamed_conflict:
    my_file:
        - {fhash: 0, state: 1, path: d, is_dir: False, sync_path_id: 1 } 
        - {fhash: 0, state: 1, path: e, is_dir: False, sync_path_id: 2 }
        - {fhash: 0, state: 1, path: c, is_dir: False, sync_path_id: 1, next_id: 1 }
        - {fhash: 0, state: 1, path: c, is_dir: False, sync_path_id: 2, next_id: 2 }
    sync_comparison:
        - { my_file_id: 4, sync_path_id: 1}
        - { my_file_id: 3, sync_path_id: 2}
